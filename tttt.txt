import xlwings as xw

# Open the Excel workbook
wb = xw.Book('your_file.xlsm')

# Access a specific sheet (by name or index)
sheet = wb.sheets['Sheet1']

# Modify the value of a specific cell (for example, A1)
sheet.range('A1').value = 'New Value'

# Refresh Bloomberg data by recalculating all Bloomberg formulas (equivalent to Ctrl + Alt + F9)
wb.app.api.Application.Run("blpRefreshAll")  # Calls Bloomberg refresh if Bloomberg API is loaded

# Alternatively, use Ctrl + Alt + F9 to fully recalculate all formulas, including Bloomberg
wb.app.api.SendKeys("^%{F9}")  # Ctrl + Alt + F9 for a full recalculation

# Trigger recalculation of all formulas in the workbook
wb.app.calculate()

# Save the workbook
wb.save()

# Close the workbook and quit the app
wb.close()
wb.app.quit()




import openpyxl
import win32com.client as win32

# Step 1: Open the Excel file and modify the specific cell
def modify_excel_cell(file_path, sheet_name, cell_ref, new_value):
    # Load the workbook and sheet
    workbook = openpyxl.load_workbook(file_path)
    sheet = workbook[sheet_name]
    
    # Modify the cell value
    sheet[cell_ref] = new_value
    
    # Save the changes
    workbook.save(file_path)
    workbook.close()

# Step 2: Refresh entire workbook with Bloomberg macro and recalculate sheets
def refresh_and_calculate(file_path):
    # Launch Excel and open the workbook
    excel_app = win32.Dispatch("Excel.Application")
    excel_app.Visible = False  # Keep Excel hidden in the background
    workbook = excel_app.Workbooks.Open(file_path)
    
    # Refresh the entire workbook (using the Bloomberg macro)
    excel_app.Run("RefreshEntireWorkbook")
    
    # Recalculate every sheet
    workbook.RefreshAll()  # Refresh data connections
    workbook.CalculateFull()  # Calculate all worksheets
    
    # Save and close the workbook
    workbook.Save()
    workbook.Close(False)
    excel_app.Quit()

# Example usage
file_path = "your_file.xlsx"
sheet_name = "Sheet1"
cell_ref = "A1"
new_value = "New Value"

# Modify the cell
modify_excel_cell(file_path, sheet_name, cell_ref, new_value)

# Refresh and calculate the entire workbook
refresh_and_calculate(file_path)

--

import openpyxl
import xlwings as xw

# Load the workbook using openpyxl
excel_file = "your_excel_file.xlsx"
wb = openpyxl.load_workbook(excel_file)

# Access Worksheet 1
ws1 = wb["Worksheet1"]
ws1["F2"] = "New Value"  # Change value of F2

# Save changes made with openpyxl
wb.save(excel_file)

# Now use xlwings to handle data refresh and calculation
app = xw.App(visible=False)  # Run in the background
wb_xw = app.books.open(excel_file)

# Access Worksheet 1
ws1_xw = wb_xw.sheets["Worksheet1"]
ws1_xw.api.RefreshAll()  # Refresh only Worksheet 1 data connections
ws1_xw.api.Calculate()   # Calculate Worksheet 1

# Access Worksheet 2
ws2_xw = wb_xw.sheets["Worksheet2"]
ws2_xw.api.RefreshAll()  # Refresh only Worksheet 2 data connections
ws2_xw.api.Calculate()   # Calculate Worksheet 2

# Save and close the workbook
wb_xw.save()
wb_xw.close()
app.quit()


import openpyxl
import win32com.client as win32

# Step 1: Load the Excel file and modify the cell F2 in Worksheet 1
file_path = "path_to_your_excel_file.xlsx"

# Load the workbook using openpyxl
wb = openpyxl.load_workbook(file_path)

# Access the first worksheet (Worksheet 1)
ws1 = wb['Worksheet1']

# Modify cell F2
ws1['F2'] = 'new_value'  # replace 'new_value' with what you want

# Save the workbook after modification
wb.save(file_path)

# Step 2: Refresh data and calculate Worksheet 1 and Worksheet 2 using pywin32
# Create Excel application object
excel = win32.Dispatch('Excel.Application')

# Open the workbook using Excel Application
wb_excel = excel.Workbooks.Open(file_path)

# Refresh all data connections
wb_excel.RefreshAll()

# Calculate Worksheet 1
ws1_excel = wb_excel.Sheets('Worksheet1')
ws1_excel.Calculate()

# Calculate Worksheet 2
ws2_excel = wb_excel.Sheets('Worksheet2')
ws2_excel.Calculate()

# Save and close the workbook
wb_excel.Save()
wb_excel.Close()

# Quit the Excel application
excel.Quit()


Sub ScrapeTablesWithClass()
    ' Tools needed:
    ' References to "Microsoft HTML Object Library" and "Microsoft XML, v6.0" must be added
    ' Go to Tools -> References -> Check the above libraries.

    Dim http As Object
    Dim html As Object
    Dim tableElements As Object
    Dim table As Object
    Dim tableClass As String
    Dim i As Integer
    
    ' Set the target URL and the table class you are looking for
    Dim url As String
    url = "https://example.com" ' Replace with your target URL
    tableClass = "your-table-class" ' Replace with the class of the table you are targeting
    
    ' Create a new XMLHTTP object to make the request
    Set http = CreateObject("MSXML2.XMLHTTP")
    
    ' Make the request to the website
    http.Open "GET", url, False
    http.send
    
    ' Create a new HTML Document object
    Set html = CreateObject("HTMLFILE")
    
    ' Load the response HTML into the HTMLDocument object
    html.body.innerHTML = http.responseText
    
    ' Get all table elements
    Set tableElements = html.getElementsByTagName("table")
    
    ' Loop through all table elements and check if they match the class
    i = 1
    For Each table In tableElements
        If table.className = tableClass Then
            Debug.Print "Table " & i & ":"
            Debug.Print table.outerHTML ' Display table HTML (for example purposes)
            i = i + 1
        End If
    Next table
    
    ' Clean up objects
    Set tableElements = Nothing
    Set html = Nothing
    Set http = Nothing
    
    MsgBox "Scraping Complete!"
End Sub
