Sub CopyWorksheetFromAPIWithHeaders()
    Dim apiURL As String
    Dim dataWorkbook As Workbook
    Dim historyDataSheet As Worksheet
    Dim existingWorkbook As Workbook
    Dim http As Object
    Dim response() As Byte
    
    ' Replace "apiURL" with the actual API endpoint that returns the Excel file
    apiURL = "https://api.example.com/get_excel_data"
    
    ' Set the existing workbook (where you want to paste the data)
    Set existingWorkbook = ThisWorkbook
    
    ' Create a new HTTP request object
    Set http = CreateObject("MSXML2.XMLHTTP")
    
    ' Make the API request with headers (replace "API_KEY" with your actual API key)
    http.Open "GET", apiURL, False
    http.setRequestHeader "Authorization", "Bearer API_KEY" ' Add any other required headers here
    http.send
    
    ' Check if the API request was successful (status 200 indicates success)
    If http.Status = 200 Then
        ' Get the binary response data
        response = http.responseBody
        
        ' Create a new workbook and paste the response content into it
        Set dataWorkbook = CreateObject("Excel.Application").Workbooks.Add
        dataWorkbook.ActiveSheet.Cells(1, 1).CopyFromRecordset CreateObject("ADODB.Stream").Open
        dataWorkbook.ActiveSheet.UsedRange.Copy ' Copy the data from the new workbook
        
        ' Set the worksheet you want to copy from the downloaded workbook
        Set historyDataSheet = dataWorkbook.Worksheets(1) ' Assuming the data is in the first sheet
        
        ' Copy the entire "HistoryData" worksheet from the downloaded workbook and paste into the existing workbook
        historyDataSheet.Copy After:=existingWorkbook.Sheets(existingWorkbook.Sheets.Count)
        
        ' Close the downloaded workbook without saving changes
        dataWorkbook.Close SaveChanges:=False
    Else
        MsgBox "API request failed. Status code: " & http.Status
    End If
End Sub
