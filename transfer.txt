Option Explicit

Declare PtrSafe Function URLDownloadToFile Lib "urlmon" Alias _
    "URLDownloadToFileA" (ByVal pCaller As Long, ByVal szURL As String, _
    ByVal szFileName As String, ByVal dwReserved As Long, ByVal lpfnCB As Long) As Long

Sub DownloadAndCopySheet()
    Dim downloadURL As String
    Dim downloadedFile As String
    Dim wbDownloaded As Workbook
    
    ' Define the URL to download the file from
    downloadURL = "http://www.test.com/test.xlsx"
    
    ' Define the path for the downloaded file
    downloadedFile = Environ("USERPROFILE") & "\Downloads\test.xlsx"
    
    ' Download the file from the URL to the Downloads folder
    If URLDownloadToFile(0, downloadURL, downloadedFile, 0, 0) = 0 Then
        ' File downloaded successfully, now open it and copy the sheet
        On Error Resume Next
        Set wbDownloaded = Workbooks.Open(downloadedFile)
        On Error GoTo 0
        
        If Not wbDownloaded Is Nothing Then
            ' Copy sheet 1 from the downloaded workbook to the current workbook
            wbDownloaded.Sheets(1).Copy Before:=ThisWorkbook.Sheets(1)
            
            ' Close the downloaded workbook without saving changes
            wbDownloaded.Close False
            
            MsgBox "Sheet copied successfully.", vbInformation
        Else
            MsgBox "Failed to open the downloaded file.", vbExclamation
        End If
    Else
        MsgBox "Failed to download the file.", vbExclamation
    End If
End Sub
